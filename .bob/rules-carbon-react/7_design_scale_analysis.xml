<?xml version="1.0" encoding="UTF-8"?>
<design_scale_analysis>
    <overview>
    Understanding the scale and dimensions of the original design is a critical first step
    that significantly impacts implementation accuracy with Carbon Design System.
    
    Design scale analysis MUST ALWAYS be performed for any images provided, and
    the design scale MUST ALWAYS be applied to any sizes measured in the image.
    This is a mandatory step in the implementation process.
    </overview>

    <critical_instructions priority="highest">
        <instruction>
            <title>AUTOMATIC ANALYSIS REQUIREMENT</title>
            <description>
        Design analysis MUST be performed AUTOMATICALLY whenever ANY image is provided.
        You MUST present a COMPLETE analysis WITHOUT waiting for the user to prompt you.
        
        This analysis MUST include all sections defined in the design_analysis_requirements in 1_workflow.xml:
        1. Component Inventory
        2. Typography Analysis
        3. Grid Analysis
        4. Spacing Analysis
        5. Layer Depth Analysis (NEW)
        
        This is NOT optional and MUST be completed BEFORE any implementation begins.
            </description>
        </instruction>

        <instruction>
            <title>MANDATORY QUESTION FORMAT</title>
            <description>
        When asking about image dimensions, you MUST ONLY use the EXACT question format below:
        
        "The image you have provided is [width]px x [height]px. Which of the following describes the image best?"
        
        With EXACTLY these three options:
        1. "The image is the actual size of our UI."
        2. "The image is smaller, scale up so that [dimension] is [larger]px."
        3. "The image is larger, scale down so that [dimension] is [smaller]px."
        
        NO OTHER questions about image dimensions are allowed. Do NOT ask "Could you provide the dimensions of the image?"
        or any similar variations. The ONLY acceptable question format is the one specified above.
            </description>
        </instruction>
    </critical_instructions>

    <mandatory_requirements>
        <requirement priority="critical">
            <title>AUTOMATICALLY perform design scale analysis</title>
            <description>
        Design scale analysis MUST be performed AUTOMATICALLY for ANY images provided by the user.
        This is NOT optional and MUST be done immediately without waiting for user prompting.
        You MUST present the complete analysis BEFORE proceeding with implementation.
            </description>
        </requirement>

        <requirement priority="critical">
            <title>Always apply design scale to measurements</title>
            <description>
        The calculated design scale MUST be applied to ALL sizes measured in any image.
        This ensures accurate implementation of typography, spacing, and component dimensions.
            </description>
        </requirement>

        <requirement priority="critical">
            <title>Always include detailed grid settings</title>
            <description>
        EVERY design analysis MUST include detailed grid settings with column spans for ALL breakpoints (sm, md, lg).
        This is critical for ensuring responsive layouts and consistent implementation.
            </description>
        </requirement>

        <requirement priority="critical">
            <title>AUTOMATICALLY present complete analysis</title>
            <description>
        You MUST AUTOMATICALLY present a COMPLETE analysis that includes all sections defined in the design_analysis_requirements in 1_workflow.xml.
        
        This analysis MUST be presented WITHOUT waiting for the user to prompt you.
        It MUST be completed BEFORE any implementation begins.
            </description>
        </requirement>

        <requirement priority="critical">
            <title>AUTOMATICALLY perform layer depth analysis</title>
            <description>
        You MUST AUTOMATICALLY analyze and document layer nesting depth for ANY images provided.
        This analysis identifies progressive background color changes that indicate nested Layer components.
        This is NOT optional and MUST be included in every design analysis.
            </description>
        </requirement>
    </mandatory_requirements>

    <workflow>
        <title>Design Scale Analysis Workflow</title>
        <steps>
            <step number="1">
                <action>Determine design dimensions</action>
                <guidance>
                    <point>Identify the dimensions of provided images (width × height in pixels)</point>
                    <point>Ask for dimensions using ONLY the mandatory question format</point>
                </guidance>
                <mandatory_example><![CDATA[
<ask_followup_question>
<question>The image you have provided is <width>px x <height>px. Which of the following describes the image best?</question>
<follow_up>
<suggest>The image is the actual size of our UI.</suggest>
<suggest>The image is smaller, scale up so that <dimension> is <larger>px.</suggest>
<suggest>The image is larger, scale down so that <dimension> is <smaller>px.</suggest>
</follow_up>
</ask_followup_question>
        ]]>                </mandatory_example>
            </step>

            <step number="2">
                <action>Calculate actual screen dimensions</action>
                <guidance>
                    <point>Determine if the provided image represents the full design or is scaled/cropped</point>
                    <point>Calculate the scale factor if the image is not at 100% scale</point>
                    <point>Identify the target breakpoint (sm, md, lg) for the design</point>
                </guidance>
            </step>

            <step number="3">
                <action>Analyze typography scale</action>
                <guidance>
                    <point>Estimate text sizes in the design based on scale factor</point>
                    <point>Map to Carbon's type scale (heading-01 through heading-07, body-01, body-02, etc.)</point>
                </guidance>
                <carbon_type_scale>
                    <type name="heading-01" size="14px" weight="600" use="Small heading" />
                    <type name="heading-02" size="16px" weight="600" use="Secondary heading" />
                    <type name="heading-03" size="20px" weight="400" use="Tertiary heading" />
                    <type name="heading-04" size="28px" weight="400" use="Main heading" />
                    <type name="heading-05" size="32px" weight="400" use="Page heading" />
                    <type name="heading-06" size="42px" weight="300" use="Large heading" />
                    <type name="heading-07" size="54px" weight="300" use="Extra large heading" />
                    <type name="body-01" size="14px" weight="400" use="Body text" />
                    <type name="body-02" size="16px" weight="400" use="Large body text" />
                </carbon_type_scale>
            </step>

            <step number="4">
                <action>Analyze component dimensions</action>
                <guidance>
                    <point>Consider fixed sizes of Carbon components</point>
                    <point>Note that buttons, form elements, and other components have predetermined dimensions</point>
                    <point>Account for icon size standards (16px, 20px, 24px, 32px)</point>
                </guidance>
                <carbon_component_sizes>
                    <component name="Button">
                        <size type="default" height="48px" />
                        <size type="small" height="32px" />
                        <size type="field" height="40px" />
                    </component>
                    <component name="Input">
                        <size type="default" height="40px" />
                        <size type="small" height="32px" />
                    </component>
                    <component name="Icon">
                        <size type="small" dimensions="16×16px" />
                        <size type="medium" dimensions="20×20px" />
                        <size type="large" dimensions="24×24px" />
                        <size type="xlarge" dimensions="32×32px" />
                    </component>
                </carbon_component_sizes>
            </step>

            <step number="5">
                <action>Analyze spacing and layout</action>
                <guidance>
                    <point>Measure visual spacing in the design, not element bounds or containers</point>
                    <point>Map visual spacing to Carbon spacing tokens</point>
                    <point>Determine appropriate grid variant (default: 32px gap, narrow: 16px gap, condensed: 0px gap)</point>
                </guidance>
                <carbon_spacing_tokens>
                    <token name="$spacing-03" value="8px" />
                    <token name="$spacing-05" value="16px" />
                    <token name="$spacing-06" value="24px" />
                    <token name="$spacing-07" value="32px" />
                    <token name="$spacing-09" value="48px" />
                </carbon_spacing_tokens>

                <spacing_guidelines>
                    <guideline priority="high">
                        Use the closest Carbon spacing tokens when other layout criteria
                        (such as Carbon Grid) do not apply
                    </guideline>

                    <guideline priority="high">
                        Be cautious with margins as they collapse in some circumstances,
                        which can result in smaller than expected spacing. Consider using
                        padding or gap properties when consistent spacing is critical.
                    </guideline>

                    <guideline priority="high">
                        Spacing should match the visual layout of the design and not be
                        affected by container bounds or invisible padding that may not be
                        visible in the design image.
                    </guideline>
                </spacing_guidelines>

                <note>
                    When measuring spacing in design images, focus on the visual distance
                    between elements as they appear in the design, not potential container
                    bounds or technical artifacts.
                </note>

                <example><![CDATA[
// Spacing Analysis:
// - Visual gap between header and content: 24px → $spacing-06
// - Card internal padding: 16px → $spacing-05
// - Gap between tiles: 16px → use gap property with $spacing-05 (avoids margin collapse)
// - Note: Container may have extra space but visual spacing is 24px
                ]]>                </example>
            </step>

            <step number="6" priority="critical">
                <action>Perform detailed grid analysis</action>
                <guidance>
                    <point>Identify all distinct logical content groups (elements that should wrap together as a unit)</point>
                    <point>Look for visual groupings, containers, or sections in the design that indicate intended structure</point>
                    <point>Identify floating elements (modals, side panels) that should NOT use Grid</point>
                    <point>Calculate column spans for all grid-based components at ALL breakpoints (sm, md, lg)</point>
                    <point>Use the formula: Math.ceil((width in pixels) / ((grid width) / (number of columns)))</point>
                    <point>Document grid settings for each logical content group in a structured format</point>
                </guidance>

                <guideline priority="high">
                    When column settings are calculated for lg, xlg or max then apply the
                    calculated number of columns to lg unless otherwise instructed.
                </guideline>

                <note>
                    Visual groupings in the design (such as sections, cards, or container-like
                    elements) often indicate the designer's intended grid structure and can help
                    identify logical content groups and appropriate column spans.
                </note>

                <carbon_grid_breakpoints>
                    <breakpoint name="sm" width="320px" columns="4" />
                    <breakpoint name="md" width="672px" columns="8" />
                    <breakpoint name="lg" width="1056px" columns="16" />
                </carbon_grid_breakpoints>
                <example><![CDATA[
// Grid Analysis:
// - Container width: 1200px (lg breakpoint)
// - Grid variant: default (32px gutters)
// - Visual grouping detected: 3 equal sections in a row
//
// Header Section:
// - sm={4} md={8} lg={16} (full width)
//
// Content Section:
// - Left panel: sm={4} md={4} lg={8} (half width on large screens)
// - Right panel: sm={4} md={4} lg={8} (half width on large screens)
//
// Form Section:
// - Form title: sm={4} md={8} lg={16} (full width)
// - Input fields: sm={4} md={4} lg={8} (half width on large screens)
// - Button: sm={4} md={4} lg={4} (quarter width on large screens)
        ]]>                </example>
            </step>

            <step number="7">
                <action>Identify Carbon theme</action>
                <guidance>
                    <point>Analyze background colors to determine which Carbon theme is being used</point>
                    <point>Identify if the design uses white, g10, g90, or g100 theme based on background color</point>
                    <point>Use Carbon MCP to look up theme background colors if needed</point>
                    <point>This theme identification will inform the layer depth analysis in the next step</point>
                </guidance>
                <mcp_usage>
                    <description>Use Carbon MCP to research theme background colors</description>
                    <example><![CDATA[
<use_mcp_tool>
<server_name>carbon-mcp</server_name>
<tool_name>docs_search</tool_name>
<arguments>
{
  "query": "theme background colors white g10 g90 g100"
}
</arguments>
</use_mcp_tool>
                    ]]>                    </example>
                </mcp_usage>
            </step>

            <step number="8" priority="critical">
                <action>Perform layer depth analysis</action>
                <guidance>
                    <point>Using the theme identified in step 7, identify ALL distinct background colors in the design</point>
                    <point>Use Carbon MCP to look up layer token values for the identified theme</point>
                    <point>Map background colors to Carbon layer tokens ($background, $layer-01, $layer-02, $layer-03)</point>
                    <point>Count the number of nested background color levels to determine layer depth</point>
                    <point>Document the layer nesting structure with visual hierarchy</point>
                    <point>Identify which elements should be wrapped in Layer components</point>
                </guidance>

                <mcp_usage>
                    <description>Use Carbon MCP to research layer token values for the identified theme</description>
                    <example><![CDATA[
<use_mcp_tool>
<server_name>carbon-mcp</server_name>
<tool_name>docs_search</tool_name>
<arguments>
{
  "query": "layer tokens background layer-01 layer-02 layer-03 [theme-name]"
}
</arguments>
</use_mcp_tool>
                    ]]>                    </example>
                    <note>Replace [theme-name] with the actual theme identified (white, g10, g90, or g100)</note>
                </mcp_usage>

                <layer_depth_detection>
                    <title>Layer Depth Detection Process</title>
                    <description>
                        Progressive background color changes indicate nested Layer components.
                        Each distinct background color level represents a new layer nesting level.
                        Use Carbon MCP to look up the actual layer token values for the identified theme.
                    </description>

                    <detection_steps>
                        <step number="1">
                            <action>Identify base background color</action>
                            <description>
                                The outermost background color is typically $background.
                                Use Carbon MCP to look up the hex value for the identified theme.
                            </description>
                        </step>

                        <step number="2">
                            <action>Identify first layer level</action>
                            <description>
                                Look for containers with a different background color from the base.
                                This is typically $layer-01.
                                Use Carbon MCP to look up the hex value for the identified theme.
                            </description>
                        </step>

                        <step number="3">
                            <action>Identify subsequent layer levels</action>
                            <description>
                                Continue identifying nested containers with progressively different backgrounds.
                                These are typically $layer-02 and $layer-03.
                                Use Carbon MCP to look up the hex values for the identified theme.
                            </description>
                        </step>

                        <step number="4">
                            <action>Count total nesting depth</action>
                            <description>
                                Count the number of distinct background color levels to determine how many nested Layer components are needed.
                            </description>
                        </step>
                    </detection_steps>

                    <visual_indicators>
                        <indicator priority="high">Progressive background color changes (lighter to darker or vice versa)</indicator>
                        <indicator priority="high">Nested containers with distinct backgrounds</indicator>
                        <indicator priority="high">Cards or panels elevated above the base background</indicator>
                        <indicator>Shadows or borders indicating depth</indicator>
                        <indicator>Visual hierarchy through background color progression</indicator>
                    </visual_indicators>

                    <analysis_template><![CDATA[
## Layer Depth Analysis

**Theme Identified:** [theme-name]
(Use Carbon MCP to look up layer token values for this theme)

**Background Color Progression:**
1. Base: $background
2. First Level: $layer-01
3. Second Level: $layer-02 (if present)
4. Third Level: $layer-03 (if present)

**Layer Nesting Depth:** [X] levels

**Layer Structure:**
```
Container (base $background)
├── Grid Row 1
│   └── Layer (withBackground) → $layer-01
│       └── Tile content
├── Layer (wraps Grid Row 2) → $layer-01
│   └── Grid Row 2
│       └── Layer (withBackground) → $layer-02
│           └── Tile content
└── Layer (wraps Layer wrapping Grid Row 3) → $layer-01
    └── Layer (wraps Grid Row 3) → $layer-02
        └── Grid Row 3
            └── Layer (withBackground) → $layer-03
                └── Tile content
```

**Implementation Notes:**
- Each nested Layer automatically increments the layer level
- Use withBackground prop when the design shows a visible background color
- Do NOT manually set the level prop - let nesting determine the level
                    ]]>                    </analysis_template>
                </layer_depth_detection>
            </step>

            <step number="9">
                <action>Document scale analysis findings</action>
                <guidance>
                    <point>Create a reference document with scale analysis findings</point>
                    <point>Include typography selections with rationale</point>
                    <point>Document component size decisions</point>
                    <point>Note spacing token selections</point>
                    <point>Include DETAILED grid settings for all sections</point>
                    <point>Include DETAILED layer depth analysis with nesting structure</point>
                </guidance>
                <example><![CDATA[
# Design Scale Analysis Summary:
# (Example showing a hypothetical g10 theme analysis)

## Image Information
- Image Dimensions: 1290px × 375px
- Actual Screen Width: 1784px
- Scale Factor: ~1.38x

## Carbon Theme
- Theme: [identified-theme] (e.g., g10, white, g90, g100)

## Layer Depth Analysis
**Theme:** [identified-theme]
(Use Carbon MCP to look up layer token values for the identified theme)
- Base Background: $background
- Layer 01: $layer-01 (e.g., tiles)
- Layer 02: $layer-02 (e.g., nested content if present)
- Total Nesting Depth: [X] levels

## Typography Selections
- Main Headline: heading-06 (28px)
- Secondary Headings: heading-03 (20px)
- Body Text: body-02 (16px)

## Component Sizes
- Buttons: default (48px height)
- Icons: medium (20px)

## Spacing
- Section Margins: $spacing-07 (32px)
- Component Padding: $spacing-05 (16px)

## Grid Implementation
- Grid Variant: Default grid (32px gutters)

## Detailed Grid Settings
### Header Section
```
<Grid>
  <Column sm={4} md={8} lg={16}>
    <!-- Header content -->
</Column>
</Grid>
```

### Main Content Section
```
<Grid>
<Column sm={4} md={4} lg={8}>
<!-- Left content -->
</Column>
<Column sm={4} md={4} lg={8}>
<!-- Right content -->
</Column>
</Grid>
```

### Form Section
```
<Grid>
<Column sm={4} md={8} lg={16}>
<!-- Form title -->
</Column>
<Column sm={4} md={4} lg={8}>
<!-- Input field 1 -->
</Column>
<Column sm={4} md={4} lg={8}>
<!-- Input field 2 -->
</Column>
<Column sm={4} md={4} lg={4}>
<!-- Submit button -->
</Column>
</Grid>
```

## Layer Nesting Structure
```
Container ($background)
├── Grid Row 1
│   └── Layer (withBackground) → $layer-01
│       └── Tile
└── Layer → $layer-01
    └── Grid Row 2
        └── Layer (withBackground) → $layer-02
            └── Tile
```
        ]]>                </example>
            </step>
        </steps>
    </workflow>

    <best_practices>
        <practice priority="critical">
            <title>Always begin with scale analysis</title>
            <description>
        Start EVERY implementation by establishing the scale and dimensions of the original design.
        This critical step ensures appropriate component selection, typography choices, and spacing decisions.
        This is not optional and must be performed for all image-based implementations.
            </description>
        </practice>

        <practice priority="high">
            <title>Apply scale to all measurements</title>
            <description>
        Always apply the calculated design scale to ALL measurements taken from images.
        This includes typography sizes, spacing values, component dimensions, and layout measurements.
        Failure to apply the scale consistently will result in inaccurate implementations.
            </description>
        </practice>

        <practice priority="critical">
            <title>Always include detailed grid settings</title>
            <description>
        EVERY design analysis MUST include detailed grid settings with column spans for ALL breakpoints.
        
        Always use separate Grid components for each logical content group (elements that should wrap together as a unit).
        
        This is critical for ensuring responsive layouts and consistent implementation.
        Always document grid settings in a structured format with code examples.
            </description>
        </practice>

        <practice priority="critical">
            <title>Always perform layer depth analysis</title>
            <description>
        EVERY design analysis MUST include layer depth analysis when background color changes are present.
        
        Count the number of distinct background color levels and document the layer nesting structure.
        This ensures proper implementation of Carbon's layer system and maintains visual hierarchy.
        
        Always document layer structure with nesting examples showing how Layer components should be nested.
            </description>
        </practice>

        <practice>
            <title>Consider component constraints</title>
            <description>
        Remember that Carbon components have fixed sizes and specific typography.
        Design scale analysis helps identify when custom styling might be needed or when
        alternative components would be more appropriate.
            </description>
        </practice>
    </best_practices>
</design_scale_analysis>

<!-- Made with Bob -->