<?xml version="1.0" encoding="UTF-8"?>
<carbon_mcp_and_packages>
    <overview>
    Essential guidance on using the Carbon MCP server and working with Carbon React libraries,
    including best practices for importing and styling components from these libraries.
    </overview>

    <ssr_detection priority="critical">
        <title>SSR and Build System Detection</title>
        <description>
      Before implementing packages with browser-only code (Web Components, certain Carbon packages),
      you MUST check for SSR indicators. Many packages contain browser-only code that will cause
      build errors in SSR environments if not handled properly.
        </description>

        <detection_steps priority="critical">
            <title>MANDATORY SSR Detection Process</title>
            <description>
        ALWAYS perform these checks BEFORE adding any package that might contain browser-only code:
            </description>
            <step number="1" priority="critical">
                <action>Check for SSR configuration files</action>
                <guidance>
                    <point>Use read_file to examine vite.config.js or webpack.config.js for explicit SSR configuration</point>
                    <point>Look for ssr: { } configuration blocks in Vite config</point>
                    <point>Check for SSR-specific build targets or entry points</point>
                </guidance>
            </step>
            <step number="2" priority="critical">
                <action>Check for SSR entry files</action>
                <guidance>
                    <point>Use list_files or search_files to look for entry-server.js, entry-server.jsx, entry-server.ts, or entry-server.tsx</point>
                    <point>Check for server.js or server.ts files in the project root or src directory</point>
                    <point>These files indicate the project uses SSR even if vite.config.js doesn't show explicit SSR config</point>
                </guidance>
                <example><![CDATA[
// Check for SSR entry files
<list_files>
<path>src</path>
<recursive>false</recursive>
</list_files>

// Search for server files
<search_files>
<path>.</path>
<regex>entry-server|server\.(js|ts|jsx|tsx)$</regex>
<file_pattern>*</file_pattern>
</search_files>
                ]]>                </example>
            </step>
            <step number="3" priority="critical">
                <action>Check package.json for SSR-related scripts</action>
                <guidance>
                    <point>Use read_file to examine package.json for build:ssr, dev:ssr, or similar scripts</point>
                    <point>Look for dependencies like @vitejs/plugin-react-ssr or similar SSR-related packages</point>
                </guidance>
            </step>
        </detection_steps>

        <ssr_indicators>
            <title>SSR Indicators Checklist</title>
            <description>If ANY of these are present, the project uses SSR:</description>
            <indicator priority="critical">entry-server.js, entry-server.jsx, entry-server.ts, or entry-server.tsx files</indicator>
            <indicator priority="critical">server.js or server.ts files in root or src directory</indicator>
            <indicator priority="high">ssr: { } configuration block in vite.config.js</indicator>
            <indicator priority="high">SSR-related scripts in package.json (build:ssr, dev:ssr, etc.)</indicator>
            <indicator priority="high">@vitejs/plugin-react-ssr or similar SSR plugins in dependencies</indicator>
        </ssr_indicators>

        <implementation_patterns>
            <pattern name="Dynamic Import with React.lazy() for SSR" priority="critical">
                <title>REQUIRED Pattern for Browser-Only Components in SSR Projects</title>
                <description>
            When a package contains browser-only code (like @carbon/web-components), you MUST use
            dynamic imports with React.lazy() to ensure the component only loads on the client side.
            Simply adding the package to ssr.external is NOT sufficient.
                </description>
                <critical_rule>
            DO NOT import browser-only packages at the top level of your component files.
            ALWAYS use dynamic imports with React.lazy() and Suspense.
                </critical_rule>
                <implementation_steps>
                    <step number="1">Create a client-only wrapper component using React.lazy()</step>
                    <step number="2">Add Suspense boundary with fallback</step>
                    <step number="3">Add the package to vite.config.js ssr.external array</step>
                    <step number="4">Verify the component returns null during SSR</step>
                </implementation_steps>
                <complete_example><![CDATA[
// CORRECT: Dynamic import with React.lazy() for browser-only component
import { lazy, Suspense } from 'react';

// Lazy load the component that uses browser-only code
const ChatComponent = lazy(() => import('./ChatComponent'));

function MyPage() {
  return (
    <div>
      <h1>My Page</h1>
      <Suspense fallback={<div>Loading chat...</div>}>
        <ChatComponent />
      </Suspense>
    </div>
  );
}

// In ChatComponent.jsx (separate file)
import { useEffect, useState } from 'react';

function ChatComponent() {
  const [Chat, setChat] = useState(null);

  useEffect(() => {
    // Dynamic import only runs on client
    import('@carbon/ai-chat/es/index.js').then((module) => {
      setChat(() => module.Chat);
    });
  }, []);

  if (!Chat) {
    return <div>Loading...</div>;
  }

  return <Chat {...props} />;
}

export default ChatComponent;

// ALSO REQUIRED: Update vite.config.js
// Add to ssr.external array
export default defineConfig({
  plugins: [react()],
  ssr: {
    external: ['@carbon/ai-chat', '@carbon/web-components']
  }
});
                ]]>                </complete_example>
                <incorrect_example><![CDATA[
// INCORRECT: Top-level import of browser-only package
import { Chat } from '@carbon/ai-chat/es/index.js';

function MyPage() {
  return (
    <div>
      <h1>My Page</h1>
      <Chat {...props} />
    </div>
  );
}
// This WILL cause SSR build errors even with ssr.external configuration!
                ]]>                </incorrect_example>
            </pattern>

            <pattern name="Alternative: useEffect with Dynamic Import">
                <description>
            For simpler cases where you don't need React.lazy(), you can use useEffect with
            dynamic imports, but you must handle the loading state properly.
                </description>
                <example><![CDATA[
// Alternative pattern using useEffect
import { useEffect, useState } from 'react';

function MyComponent() {
  const [BrowserComponent, setBrowserComponent] = useState(null);

  useEffect(() => {
    // Only runs on client
    import('browser-only-package').then((module) => {
      setBrowserComponent(() => module.default);
    });
  }, []);

  // Return null during SSR
  if (!BrowserComponent) {
    return <div>Loading...</div>;
  }

  return <BrowserComponent {...props} />;
}
                ]]>                </example>
            </pattern>
        </implementation_patterns>

        <configuration_requirements priority="critical">
            <title>REQUIRED Vite Configuration Updates</title>
            <description>
        When using packages with browser-only code in SSR projects, you MUST update vite.config.js
        to prevent the build system from processing these packages during SSR.
            </description>
            <requirement priority="critical">
                <title>Add packages to ssr.external array</title>
                <description>
            This tells Vite not to process these packages during SSR build.
            However, this alone is NOT sufficient - you must also use dynamic imports.
                </description>
                <example><![CDATA[
// vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  ssr: {
    external: [
      '@carbon/ai-chat',
      '@carbon/web-components',
      // Add any other packages with browser-only code
    ]
  }
});
                ]]>                </example>
            </requirement>
            <requirement priority="high">
                <title>Verify configuration syntax</title>
                <guidance>
                    <point>Ensure the ssr object is at the top level of the config, not nested inside plugins</point>
                    <point>Use an array for the external property, not a string</point>
                    <point>Include all packages that depend on browser-only code (e.g., if @carbon/ai-chat uses @carbon/web-components, include both)</point>
                </guidance>
            </requirement>
        </configuration_requirements>

        <verification_checklist>
            <title>SSR Compatibility Verification Checklist</title>
            <item priority="critical">Checked for entry-server files using list_files or search_files</item>
            <item priority="critical">Checked for server.js files in project</item>
            <item priority="critical">Read vite.config.js to check for SSR configuration</item>
            <item priority="critical">Used dynamic imports with React.lazy() for browser-only components</item>
            <item priority="critical">Added browser-only packages to ssr.external array in vite.config.js</item>
            <item priority="high">Verified configuration syntax is correct</item>
            <item priority="high">Tested that component returns null/loading state during SSR</item>
        </verification_checklist>
    </ssr_detection>

    <theme_configuration priority="high">
        <title>Carbon Theme Configuration</title>
        <description>
      Carbon components inherit theme from the host page by default.
      Only use explicit theme configuration when the host does NOT use Carbon.
        </description>
        <rules>
            <rule priority="critical">Check if host application uses Carbon before setting explicit themes</rule>
            <rule priority="high">Omit theme config when host has theme management or uses @carbon/react</rule>
            <rule>Use explicit theme properties only for non-Carbon applications</rule>
        </rules>
        <detection>
            <indicator>Theme context or components in project</indicator>
            <indicator>@carbon/react already installed and used</indicator>
        </detection>
    </theme_configuration>

    <carbon_mcp>
        <title>Carbon MCP Server</title>
        <description>
      The Carbon MCP server provides tools for searching Carbon Design System documentation and code examples.
      Use these tools to research components, patterns, and implementation approaches.
        </description>

        <tools>
            <tool name="docs_search">
                <description>Search Carbon Design System documentation</description>
                <usage><![CDATA[
<use_mcp_tool>
<server_name>carbon-mcp</server_name>
<tool_name>docs_search</tool_name>
<arguments>
{
  "query": "your search query"
}
</arguments>
</use_mcp_tool>
        ]]>                </usage>
                <when_to_use>
                    <scenario>When looking for design guidelines</scenario>
                    <scenario>When researching component usage patterns</scenario>
                    <scenario>When checking accessibility requirements</scenario>
                    <scenario>When researching Carbon AI Chat documentation (APIs, types, migration guides)</scenario>
                </when_to_use>
            </tool>

            <tool name="code_search">
                <description>Search Carbon components code examples</description>
                <usage><![CDATA[
<use_mcp_tool>
<server_name>carbon-mcp</server_name>
<tool_name>code_search</tool_name>
<arguments>
{
  "query": "your code search query"
}
</arguments>
</use_mcp_tool>
        ]]>                </usage>
                <when_to_use>
                    <scenario>When looking for implementation examples</scenario>
                    <scenario>When researching component props and usage</scenario>
                    <scenario>When checking for best practices in code</scenario>
                    <scenario>When looking for Carbon AI Chat code examples and sample applications</scenario>
                </when_to_use>
            </tool>
        </tools>

        <search_strategies>
            <strategy name="Component Research">
                <description>When implementing a specific component, search for its documentation and examples</description>
                <example_queries>
                    <query>button usage</query>
                    <query>data table pagination</query>
                    <query>modal accessibility</query>
                </example_queries>
            </strategy>

            <strategy name="Pattern Research">
                <description>When implementing a common UI pattern, search for relevant guidance</description>
                <example_queries>
                    <query>form validation</query>
                    <query>responsive layout</query>
                    <query>data visualization</query>
                </example_queries>
            </strategy>

            <strategy name="AI Chat Documentation Research">
                <description>When implementing Carbon AI Chat features, search for API documentation, types, and migration guides</description>
                <example_queries>
                    <query>PublicChatState</query>
                    <query>ChatInstance</query>
                    <query>PublicConfig baseUrl</query>
                    <query>assistant tool usage</query>
                    <query>migration-1.0.0 breaking changes</query>
                </example_queries>
                <guidelines>
                    <guideline>Do not set filters.component_type, filters.component_id, or filters.ibm_products for AI Chat docs</guideline>
                    <guideline>Query directly with API/type names or migration topics</guideline>
                    <guideline>For upgrade/migration queries, include "migration-1.0.0" in the query</guideline>
                </guidelines>
            </strategy>

            <strategy name="AI Chat Code Examples Research">
                <description>When implementing Carbon AI Chat features, search for code examples and sample applications</description>
                <example_queries>
                    <query>ai chat react basic</query>
                    <query>ai chat web components custom element</query>
                    <query>ai chat history</query>
                    <query>ai chat watsonx</query>
                </example_queries>
                <guidelines>
                    <guideline priority="critical">ALWAYS set filters.component_type to "React" or "Web Components" based on user's framework</guideline>
                    <guideline>Do not set filters.ibm_products for AI Chat examples</guideline>
                    <guideline>Include "ai chat" phrase in query for intent targeting</guideline>
                    <guideline>Include example root (basic, custom-element, history, watsonx, watch-state) when known</guideline>
                    <guideline>For specific file retrieval, include filename in query (e.g., "customLoadHistory.ts")</guideline>
                    <guideline>Server automatically provides complete files even if they span multiple chunks</guideline>
                </guidelines>
                <example_usage><![CDATA[
<use_mcp_tool>
<server_name>carbon-mcp</server_name>
<tool_name>code_search</tool_name>
<arguments>
{
  "query": "ai chat react basic",
  "size": 15,
  "filters": {
    "component_type": "React"
  }
}
</arguments>
</use_mcp_tool>
        ]]>                </example_usage>
            </strategy>
        </search_strategies>
    </carbon_mcp>

    <carbon_packages>
        <title>Carbon React Libraries</title>
        <description>
      Carbon React libraries (defined as Carbon v11 packages including @carbon/react, Carbon for IBM Products,
      Carbon Icons, Carbon Pictograms, Carbon Charts and other Carbon React libraries) provide components
      for building consistent, accessible interfaces. Always use these official packages directly rather
      than recreating components or functionality.
        </description>

        <component_stability>
            <title>Component Stability and Usage Guidelines</title>
            <description>
        Carbon does not duplicate components. The only exceptions are components being redesigned
        in @carbon/labs-react before transfer to @carbon/react, or @carbon/ibm-products components
        moving to core Carbon.
            </description>

            <stability_levels>
                <level name="stable">
                    <description>Production-ready components in Carbon React libraries</description>
                    <usage_rule>Use freely in production applications</usage_rule>
                </level>

                <level name="unstable_preview">
                    <description>
            Components marked as "unstable" or "preview" in @carbon/react.
            IBM Products sometimes refers to unstable components as "canary".
                    </description>
                    <usage_rule priority="critical">
            DO NOT use unstable, preview, or canary components unless explicitly instructed by the user.
            Once the user has instructed their use locally, you may assume they can continue to be used.
                    </usage_rule>
                    <rationale>
            These components are experimental and may have breaking changes or incomplete functionality.
            They should only be used when the user has made an informed decision to accept the risks.
                    </rationale>
                </level>

                <level name="labs">
                    <description>
            Experimental components in @carbon/labs-react being developed or redesigned
            before potential transfer to @carbon/react
                    </description>
                    <usage_rule priority="critical">
            DO NOT use @carbon/labs-react components unless explicitly instructed by the user.
            Once the user has instructed their use locally, you may assume they can continue to be used.
                    </usage_rule>
                    <rationale>
            Labs components are experimental and undergoing active development. They may have
            significant API changes or be deprecated without notice.
                    </rationale>
                </level>
            </stability_levels>

            <decision_workflow>
                <step number="1">
                    <question>Is there a stable component in Carbon React libraries that meets the requirement?</question>
                    <action>Use the stable component from Carbon React libraries</action>
                </step>
                <step number="2">
                    <question>Has the user explicitly instructed use of an unstable/preview/canary/labs component?</question>
                    <if_yes>
                        <action>Use the component as instructed and document its experimental status</action>
                    </if_yes>
                    <if_no>
                        <action>Do not use experimental components; propose stable alternatives or custom implementation</action>
                    </if_no>
                </step>
            </decision_workflow>
        </component_stability>

        <core_packages>
            <package name="@carbon/react">
                <description>
          Core Carbon React components library. This is the main package for Carbon React libraries.
                </description>
                <import_example><![CDATA[
import { Button, Tile, Grid, Column } from '@carbon/react';
        ]]>                </import_example>
            </package>

            <package name="@carbon/icons-react">
                <description>
          Carbon icons library for React. Provides a comprehensive set of icons.
                </description>
                <import_example><![CDATA[
import { Add, Search, Information } from '@carbon/icons-react';
        ]]>                </import_example>
            </package>

            <package name="@carbon/charts">
                <description>
          Carbon charts library. Provides data visualization components.
                </description>
                <import_example><![CDATA[
import { BarChart, LineChart } from '@carbon/charts-react';
        ]]>                </import_example>
                <styling_requirements>
                    <requirement>
            Import the styles:
                        <code><![CDATA[
@use '@carbon/charts/styles.css';
            ]]>                        </code>
                    </requirement>
                </styling_requirements>
            </package>
        </core_packages>

        <additional_packages>
            <package name="@carbon/ibm-products">
                <description>
          Extended components for IBM products, building on Carbon components.
          This package provides additional, more complex components that are commonly used in IBM products.
                </description>
                <import_example><![CDATA[
import { ProductiveCard, SidePanel, TagSet } from '@carbon/ibm-products';
        ]]>                </import_example>
                <installation>
                    <code>npm install @carbon/ibm-products</code>
                </installation>
                <styling_requirements>
                    <requirement>
            Import the styles:
                        <code><![CDATA[
@use '@carbon/ibm-products/css/index-full.css';
            ]]>                        </code>
                    </requirement>
                </styling_requirements>
            </package>

            <package name="@carbon/pictograms-react">
                <description>
          Carbon pictograms library for React. Provides larger, more detailed illustrations.
                </description>
                <import_example><![CDATA[
import { Analytics, Cloud, Security } from '@carbon/pictograms-react';
        ]]>                </import_example>
            </package>

            <package name="@carbon/ai-chat">
                <description>
          Carbon AI Chat library for React and Web Components. Provides conversational AI interface components.
                </description>
                <import_example><![CDATA[
import { ChatContainer } from '@carbon/ai-chat';
        ]]>                </import_example>
                <installation>
                    <code>npm install @carbon/ai-chat</code>
                </installation>
                <styling_requirements>
                    <requirement priority="critical">
                        <title>NO CSS Import Required</title>
                        <description>
                Unlike other Carbon packages, @carbon/ai-chat does NOT require a separate CSS import.
                The styles are encapsulated within the Web Components.
                
                DO NOT attempt to import CSS from @carbon/ai-chat/es/index.css or similar paths.
                These files do not exist and will cause build errors.
                        </description>
                    </requirement>
                    <requirement priority="critical">
                        <title>SSR Compatibility</title>
                        <description>
                @carbon/ai-chat contains browser-only code and requires special handling in SSR projects.
                See ssr_detection section in this file for complete guidance.
                
                Required steps:
                1. Add @carbon/ai-chat and @carbon/web-components to vite.config.js ssr.external array
                2. Use dynamic imports with React.lazy() for all components that use @carbon/ai-chat
                3. Never use top-level imports of @carbon/ai-chat in SSR projects
                        </description>
                    </requirement>
                </styling_requirements>
                <best_practices>
                    <practice priority="high">Use ChatContainer for standard implementations</practice>
                    <practice priority="high">Implement custom message handlers for backend integration</practice>
                    <practice>Use ChatCustomElement for custom positioning requirements</practice>
                </best_practices>
            </package>
        </additional_packages>
    </carbon_packages>

    <best_practices>
        <title>Best Practices for Using Carbon React Libraries</title>

        <practice name="Use Official Components">
            <description>
        Always use official components from Carbon React libraries rather than recreating them.
        This ensures consistency, accessibility, and maintainability.
            </description>
            <example><![CDATA[
// Good: Using Carbon's Button component
import { Button } from '@carbon/react';

<Button kind="primary">Submit</Button>

// Bad: Creating a custom button that mimics Carbon
<button className="custom-carbon-button">Submit</button>
      ]]>            </example>
        </practice>

        <practice name="Add Required Dependencies">
            <description>
        When a component from a Carbon React library is needed but the package is not in the project,
        add the dependency rather than recreating the component. Carbon does not duplicate components,
        so always prefer using the official package.
            </description>
            <example><![CDATA[
// If you need IBM Products components:
// 1. Add the dependency:
// npm install @carbon/ibm-products

// 2. Import and use the component:
import { ProductiveCard } from '@carbon/ibm-products';

<ProductiveCard title="Example Card">
  Card content
</ProductiveCard>
      ]]>            </example>
            <important_note>
        Do not recreate components that exist in Carbon React libraries. Always add the required
        package and use the official component to ensure consistency, accessibility, and maintainability.
            </important_note>
        </practice>

        <practice name="Add Required Styling">
            <description>
        When importing new Carbon React libraries, ensure you also add the required styling.
            </description>
            <example><![CDATA[
// In your main SCSS file:
@use '@carbon/react';
@use '@carbon/charts/styles.css';
@use '@carbon/ibm-products/css/index-full.css';
      ]]>            </example>
            <general_rule priority="high">
                <title>Verify Package Styling Requirements</title>
                <description>
            Before adding CSS/SCSS imports for any Carbon package:
            1. Check the package's documentation for styling requirements
            2. Use Carbon MCP to search for styling examples
            3. When available, examine the package structure (node_modules/@carbon/package-name/dist/)
            4. Look for existing usage examples in the Carbon MCP code search
            
            Not all Carbon packages require separate CSS imports. Some packages (like @carbon/ai-chat)
            use Web Components with encapsulated styles.
                </description>
            </general_rule>
        </practice>

        <practice name="Use MCP for Research">
            <description>
        Use the Carbon MCP server to research components and patterns before implementation.
        This ensures you follow best practices and leverage existing solutions.
            </description>
            <example><![CDATA[
// When implementing a data table with pagination:
<use_mcp_tool>
<server_name>carbon-mcp</server_name>
<tool_name>docs_search</tool_name>
<arguments>
{
  "query": "data table pagination"
}
</arguments>
</use_mcp_tool>
      ]]>            </example>
        </practice>
    </best_practices>
</carbon_mcp_and_packages>

<!-- Made with Bob -->